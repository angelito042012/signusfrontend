<div class="max-w-4xl mx-auto p-6">
  <h1 class="text-2xl font-bold mb-4">Mis pedidos</h1>

  <p *ngIf="cargando" class="text-center text-gray-500 py-6">
    Cargando pedidos...
  </p>

  <p *ngIf="!cargando && pedidos.length === 0" class="text-center text-gray-500 py-6">
    No tienes pedidos registrados.
  </p>

  <!-- Lista de pedidos -->
  <div class="space-y-6" *ngIf="pedidos.length > 0">
    <div
      *ngFor="let p of pedidos"
      class="border rounded-lg p-6 shadow-md hover:shadow-lg transition-shadow bg-white"
    >
      <!-- Encabezado del pedido -->
      <div class="flex justify-between items-center">
        <div>
          <p class="text-lg font-semibold text-gray-800">
            Pedido #{{ p.idPedido }}
          </p>
          <p class="text-sm text-gray-600">
            Realizado el: {{ formatearFecha(p.fecha) }}
          </p>
        </div>

        <!-- Estado del pedido -->
        <span
          class="px-3 py-1 text-sm font-semibold rounded-full"
          [ngClass]="getColorEstado(p.estado)"
        >
          {{ p.estado }}
        </span>
      </div>

      <!-- Información del pedido -->
      <div class="mt-4 text-sm text-gray-700 grid grid-cols-1 md:grid-cols-2 gap-4">
        <p><strong>Total:</strong> S/. {{ p.venta.total }}</p>
        <p><strong>Método de pago:</strong> {{ p.venta.metodoPago.nombre }}</p>
        <p><strong>Tipo de envío:</strong> {{ p.tipoEnvio }}</p>
        <p><strong>Dirección de envío:</strong> {{ p.direccionEnvio }}</p>
      </div>

      <hr class="my-4">

      <!-- Productos -->
      <p class="font-medium mb-2 text-gray-800">Productos:</p>

      <!-- Botón para cargar detalles -->
      <button
        pButton
        label="Ver detalles"
        icon="pi pi-eye"
        class="p-button-sm p-button-secondary mb-3"
        (click)="cargarDetallesPedido(p.idPedido)"
        [disabled]="cargandoDetalles[p.idPedido]"
      ></button>

      <!-- Spinner mientras cargan los detalles -->
      <div *ngIf="cargandoDetalles[p.idPedido]" class="flex justify-center py-4">
        <p-progressSpinner></p-progressSpinner>
      </div>

      <!-- Tabla de detalles -->
      <table
        class="w-full text-sm border-collapse"
        *ngIf="detallesPedido[p.idPedido] && !cargandoDetalles[p.idPedido]"
      >
        <thead>
          <tr class="border-b bg-gray-100">
            <th class="p-2 text-left">Producto</th>
            <th class="p-2 text-center">Cantidad</th>
            <th class="p-2 text-center">Precio Unitario</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let d of detallesPedido[p.idPedido]">
            <td class="p-2">{{ d.producto?.nombre }}</td>
            <td class="p-2 text-center">{{ d.cantidad }}</td>
            <td class="p-2 text-center">S/. {{ d.precioUnitario }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<p-toast></p-toast>

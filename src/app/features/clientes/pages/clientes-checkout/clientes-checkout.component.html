<div class="max-w-4xl mx-auto p-6">
  <h1 class="text-2xl font-bold mb-4">Checkout</h1>

  <!-- Indicador de carga -->
  <div *ngIf="loading" class="flex justify-center items-center py-6">
    <p-progressSpinner></p-progressSpinner>
  </div>

  <!-- Contenido principal -->
  <div *ngIf="!loading">
    <!-- DETALLES DEL CARRITO -->
    <div class="border rounded-lg shadow-md p-4 mb-6 bg-white">
      <h2 class="text-xl font-semibold mb-4 text-gray-800">
        Resumen de compra
      </h2>

      <div class="space-y-4">
        <!-- Producto -->
        <div
          *ngFor="let d of detalles"
          class="flex items-center gap-4 border-b pb-4 last:border-b-0"
        >
          <!-- Imagen del producto -->
          <img
            [src]="d.producto?.imagen || 'https://via.placeholder.com/80'"
            alt="{{ d.producto?.nombre }}"
            class="w-16 h-16 object-cover rounded-lg border"
          />

          <!-- Información del producto -->
          <div class="flex-1">
            <h3 class="text-gray-800 font-semibold">
              {{ d.producto?.nombre }}
            </h3>
            <p class="text-sm text-gray-500">Cantidad: {{ d.cantidad }}</p>
            <p class="text-sm text-gray-500">
              Precio unitario: S/. {{ d.precioUnitario }}
            </p>
          </div>

          <!-- Subtotal -->
          <div class="text-right">
            <p class="text-lg font-bold text-gray-800">S/. {{ d.subtotal }}</p>
          </div>
        </div>
      </div>

      <!-- Total -->
      <div class="text-right text-xl font-bold mt-6 text-gray-800">
        Total: S/. {{ total }}
      </div>
    </div>

    <!-- DATOS DE ENVÍO -->
    <div class="border rounded-lg shadow-md p-4 mb-6 bg-white">
      <h2 class="text-xl font-semibold mb-4 text-gray-800">Datos de envío</h2>

      <!-- Botón para cargar datos automáticamente -->
      <button
        pButton
        label="Cargar datos del envío según mi perfil"
        icon="pi pi-user"
        class="p-button-secondary mb-6 w-full"
        (click)="cargarDatosCliente()"
      ></button>

      <!-- Inputs para llenar los datos -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Nombres -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Nombres</label
          >
          <input
            pInputText
            type="text"
            class="p-inputtext w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500"
            [(ngModel)]="form.nombres"
          />
        </div>

        <!-- Apellidos -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Apellidos</label
          >
          <input
            pInputText
            type="text"
            class="p-inputtext w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500"
            [(ngModel)]="form.apellidos"
          />
        </div>

        <!-- DNI -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >DNI</label
          >
          <input
            pInputText
            type="text"
            class="p-inputtext w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500"
            [(ngModel)]="form.dni"
          />
        </div>

        <!-- Teléfono -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Teléfono</label
          >
          <input
            pInputText
            type="text"
            class="p-inputtext w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500"
            [(ngModel)]="form.telefono"
          />
        </div>

        <!-- Dirección -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Dirección</label
          >
          <input
            pInputText
            type="text"
            class="p-inputtext w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500"
            [(ngModel)]="form.direccion"
          />
        </div>

        <!-- Departamento -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Departamento</label
          >
          <input
            pInputText
            type="text"
            class="p-inputtext w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500"
            [(ngModel)]="form.departamento"
          />
        </div>

        <!-- Provincia -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Provincia</label
          >
          <input
            pInputText
            type="text"
            class="p-inputtext w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500"
            [(ngModel)]="form.provincia"
          />
        </div>

        <!-- Distrito -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Distrito</label
          >
          <input
            pInputText
            type="text"
            class="p-inputtext w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500"
            [(ngModel)]="form.distrito"
          />
        </div>
      </div>
    </div>

    <!-- SELECCIÓN DE ENVÍO -->
    <div class="border rounded-lg shadow-md p-4 mb-6 bg-white">
      <h2 class="text-xl font-semibold mb-4 text-gray-800">Forma de entrega</h2>

      <div class="grid grid-cols-1 gap-4">
        <!-- Opción de envío estándar -->
        <div
          class="border rounded p-4 flex items-center gap-4 cursor-pointer hover:shadow-md transition-shadow"
          [ngClass]="{
            'border-green-500 bg-green-50': form.tipoEnvio === 'ESTANDAR'
          }"
          (click)="form.tipoEnvio = 'ESTANDAR'"
        >
          <p-radioButton
            name="tipoEnvio"
            value="ESTANDAR"
            [(ngModel)]="form.tipoEnvio"
          ></p-radioButton>
          <div class="flex-1">
            <h3 class="text-lg font-semibold">Envío Estándar</h3>
            <p class="text-sm text-gray-500">Entrega en 3-7 días hábiles</p>
          </div>
          <div class="text-right">
            <p class="text-lg font-bold">Gratis</p>
          </div>
        </div>
      </div>
    </div>

    <!-- DATOS DE PAGO -->
    <div class="border rounded-lg shadow-md p-4 mb-6 bg-white">
      <h2 class="text-xl font-semibold mb-4 text-gray-800">Datos de pago</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Primer Nombre -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Nombre</label
          >
          <input
            pInputText
            type="text"
            class="p-inputtext w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500"
            [(ngModel)]="formPago.nombre"
          />
        </div>

        <!-- Primer Apellido -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Apellido</label
          >
          <input
            pInputText
            type="text"
            class="p-inputtext w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500"
            [(ngModel)]="formPago.apellido"
          />
        </div>

        <!-- Número de tarjeta -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Número de tarjeta</label
          >
          <input
            pInputText
            type="text"
            class="p-inputtext w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500"
            maxlength="16"
            [(ngModel)]="formPago.numeroTarjeta"
          />
        </div>

        <!-- CVV -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >CVV</label
          >
          <input
            pInputText
            type="password"
            maxlength="3"
            class="p-inputtext w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500"
            [(ngModel)]="formPago.cvv"
          />
        </div>

        <!-- Fecha de vencimiento -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Fecha de vencimiento</label
          >
          <input
            pInputText
            type="text"
            maxlength="5"
            class="p-inputtext w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-500"
            placeholder="MM/YY"
            [(ngModel)]="formPago.fechaVencimiento"
          />
        </div>
      </div>
    </div>

    <!-- BOTÓN FINAL -->
    <button
      pButton
      label="Confirmar pedido"
      icon="pi pi-check"
      class="w-full p-button-success"
      (click)="confirmarPedido()"
    ></button>
  </div>
</div>

<p-toast></p-toast>
